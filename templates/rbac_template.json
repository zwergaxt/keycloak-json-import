{
    "allowRemoteResourceManagement": true,
    "policyEnforcementMode": "ENFORCING",
    "resources": [
        {
            "name": "kafka-cluster:{{ cluster_name }},Cluster:*",
            "type": "Cluster",
            "ownerManagedAccess": false,
            "displayName": "Cluster scopes on {{ cluster_name }}",
            "attributes": {},
            "uris": [],
            "scopes": [
                {
                    "name": "DescribeConfigs"
                },
                {
                    "name": "Describe"
                },
                {
                    "name": "Read"
                },
                {
                    "name": "Alter"
                },
                {
                    "name": "AlterConfigs"
                },
                {
                    "name": "ClusterAction"
                },
                {
                    "name": "IdempotentWrite"
                }
            ]
        },
        {% for t in topics %}
        {
            "name": "kafka-cluster:{{ cluster_name }},Topic:{{ t.resource_name }}",
            "type": "Topic",
            "ownerManagedAccess": false,
            "displayName": "Topic:{{ cluster_name }}:{{ t.resource_name }}",
            "attributes": {},
            "uris": [],
            "scopes": [
                {
                    "name": "Create"
                },
                {
                    "name": "Read"
                },
                {
                    "name": "Delete"
                },
                {
                    "name": "Alter"
                },
                {
                    "name": "Describe"
                },
                {
                    "name": "DescribeConfigs"
                },
                {
                    "name": "AlterConfigs"
                },
                {
                    "name": "Write"
                }
            ]
        {# check if t is last item #}
        },
        {% endfor %}
        {
            "name": "kafka-cluster:{{ cluster_name }},Group:*",
            "type": "Group",
            "ownerManagedAccess": false,
            "displayName": "Group:{{ cluster_name }}:*",
            "attributes": {},
            "uris": [],
            "scopes": [
                {
                    "name": "Describe"
                },
                {
                    "name": "Read"
                },
                {
                    "name": "Alter"
                },
                {
                    "name": "DescribeConfigs"
                },
                {
                    "name": "AlterConfigs"
                }
            ]
        }
    ],
    "policies": [
        {
            "name": "Cluster:{{ cluster_name }}",
            "type": "scope",
            "logic": "POSITIVE",
            "decisionStrategy": "AFFIRMATIVE",
            "config": {
                "resources": "[\"kafka-cluster:{{ cluster_name }},Cluster:*\"]",
                "applyPolicies": "[{% for t in topics %} \"{{ t.ad_group_name|upper }}\"{% if t == topics|last %}{% else %},{% endif %}{% endfor %}]",
                "scopes": "[\"Describe\",\"Read\",\"Alter\",\"IdempotentWrite\",\"DescribeConfigs\",\"AlterConfigs\"]"
            }
        },
        {
            "name": "Group:{{ cluster_name }}",
            "type": "scope",
            "logic": "POSITIVE",
            "decisionStrategy": "AFFIRMATIVE",
            "config": {
                "resources": "[\"kafka-cluster:{{ cluster_name }},Group:*\"]",
                "applyPolicies": "[{% for t in topics %} \"{{ t.ad_group_name|upper }}\"{% if t == topics|last %}{% else %},{% endif %}{% endfor %}]",
                "scopes": "[\"Describe\",\"Read\",\"Alter\",\"DescribeConfigs\",\"AlterConfigs\"]"
            }
        },
        {% for t in topics %}
        {
            "name": "{{ t.ad_group_name }}",
            "type": "group",
            "logic": "POSITIVE",
            "decisionStrategy": "AFFIRMATIVE",
            "config": {
                "groups": 
                    "[{\"path\":\"/{{ t.ad_group_name }}\",\"extendChildren\":false}]"

            }
        },
        {% if t.role == "P" %}
        {
            "name": "Producer:{{ cluster_name }}:{{ t.resource_name }}:{{ t.ad_group_name }}",
            "type": "scope",
            "logic": "POSITIVE",
            "decisionStrategy": "AFFIRMATIVE",
            "config": {
                "resources": "[\"kafka-cluster:{{ cluster_name }},Topic:{{ t.resource_name }}\"]",
                "applyPolicies": "[\"{{ t.ad_group_name }}\"]",
                "scopes": "[\"Write\"]"
            }
        },
        {% else %}
        {
            "name": "Consumer:{{ cluster_name }}:{{ t.resource_name }}:{{ t.ad_group_name }}",
            "type": "scope",
            "logic": "POSITIVE",
            "decisionStrategy": "AFFIRMATIVE",
            "config": {
                "resources": "[\"kafka-cluster:{{ cluster_name }},Topic:{{ t.resource_name }}\"]",
                "applyPolicies": "[\"{{ t.ad_group_name }}\"]",
                "scopes": "[\"Read\"]"
            }
        },
        {% endif %}
        {% endfor %}
        {% for i in describe_rules %}
        {
            "name": "Describe:{{ cluster_name }}:{{ i.resource_name }}",
            "type": "scope",
            "logic": "POSITIVE",
            "decisionStrategy": "AFFIRMATIVE",
            "config": {
                "resources": "[\"kafka-cluster:{{ cluster_name }},Topic:{{ i.resource_name }}\"]",
                "applyPolicies": "[{% for g in i.ad_group_name %} \"{{ g }}\" {% if g == i.ad_group_name|last %} {% else %},{% endif %} {% endfor %}]",
                "scopes": "[\"Describe\"]"
            }
        }{% if i == describe_rules|last %} {% else %},{% endif %}
        {% endfor %}
    ]
    

}